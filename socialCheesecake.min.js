/*
 SocialCheesecake JavaScript Library v0.4.0
 https://github.com/adiezbal/SocialCheesecake
 Developed by Alicia Diez (https://github.com/adiezbal)
 Copyright 2011, Technical University of Madrid (Universidad Politecnica de Madrid)
 Licensed under the MIT or GPL Version 2 licenses.
 Date: Dec 22 2011

 Copyright (C) 2011 by Technical University of Madrid (Universidad Polit?cnica de Madrid)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
var socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.Actor=function(a){if(!a)throw"No arguments passed to the function";if(!a.parent)throw"Actor must be associated to at least a subsector";this.id=a.id;this.name=a.name;this.extraInfo=a.extraInfo?a.extraInfo:void 0;this.opacity=socialCheesecake.Grid.maxOpacity;this._selected=this._focused=!1;this._hidden=!0;this._filtered=!1;this.fading="none";this.parents=[];a.parent&&this.parents.push(a.parent);var b=this,a=b.getDiv();a.addEventListener("mouseover",function(){var a;b.focus();
for(var d in b.parents)a=b.parents[d].parent,a.focus(),a.colorHandler("mouseover"),b.parents[d].colorHandler("mouseover")},!1);a.addEventListener("mouseout",function(){var a;b.unfocus();for(var d in b.parents)a=b.parents[d].parent,a.unfocus(),a.colorHandler("mouseout"),b.parents[d].colorHandler("mouseout")},!1);a.addEventListener("click",function(){b.isSelected()?b.unselect():(b.select(),b.unfocus())},!1)};socialCheesecake.Actor.prototype.getParentsIds=function(){var a=this.parents,b=[],c;for(c in a)b.push(a[c].id);
return b};socialCheesecake.Actor.prototype.addClass=function(a){var b=this.getDiv(),c="",d=RegExp("(^|\\s)"+a+"($|\\s)");b.getAttribute("class")?(c=b.getAttribute("class"),c.match(d)||(c=c.concat(" "+a),b.setAttribute("class",c))):b.setAttribute("class",a)};socialCheesecake.Actor.prototype.removeClass=function(a){var b=this.getDiv(),c="",d=RegExp("(^|\\s)"+a+"($|\\s)");b.getAttribute("class")&&(c=b.getAttribute("class"),c.match(d)&&(c=b.getAttribute("class").replace(RegExp("(^|\\s)"+a),""),b.setAttribute("class",
c)))};socialCheesecake.Actor.prototype.isSelected=function(){return this._selected};socialCheesecake.Actor.prototype.select=function(){this._selected=!0;this.addClass("selected")};socialCheesecake.Actor.prototype.unselect=function(){this._selected=!1;this.removeClass("selected")};socialCheesecake.Actor.prototype.focus=function(){this._focused=!0;this.addClass("focused")};socialCheesecake.Actor.prototype.unfocus=function(){this._focused=!1;this.removeClass("focused")};socialCheesecake.Actor.prototype.isFocused=
function(){this.getCheesecake();return this._focused};socialCheesecake.Actor.prototype.hide=function(){var a=this.getDiv(),b=" display: none;";this._hidden=!0;a.getAttribute("style")&&(b=a.getAttribute("style").match(/display\s*:\s*[a-z]*;/)?a.getAttribute("style").replace(/display\s*:\s*[a-z]*;/,"display: none;"):a.getAttribute("style").concat("display: none;"));a.setAttribute("style",b);this.fading="none"};socialCheesecake.Actor.prototype.show=function(){var a=this.getDiv(),b=" display: inline;";
this.isFiltered()||(this._hidden=!1,a.getAttribute("style")&&(b=a.getAttribute("style").match(/display\s*:\s*[a-z]*;/)?a.getAttribute("style").replace(/display\s*:\s*[a-z]*;/,"display: inline;"):a.getAttribute("style").concat("display: inline;")),a.setAttribute("style",b))};socialCheesecake.Actor.prototype.isHidden=function(){return this._hidden};socialCheesecake.Actor.prototype.isFiltered=function(){return this._filtered};socialCheesecake.Actor.prototype.isVisible=function(){return!(this.isHidden()||
this.isFiltered())};socialCheesecake.Actor.prototype.filter=function(){this._filtered=!0;this.fadeOut(100,!0)};socialCheesecake.Actor.prototype.unfilter=function(){this._filtered=!1};socialCheesecake.Actor.prototype.setDivOpacity=function(a){var a=1<a?1:a,a=0>a?0:a,b=this.getDiv();this.opacity=a;a="opacity: "+this.opacity+";";b.getAttribute("style")&&(a=b.getAttribute("style").replace(/opacity\s*:\s*[a-zA-Z0-9.]*;/g,""),a=a.concat("opacity: "+this.opacity+";"));b.setAttribute("style",a)};socialCheesecake.Actor.prototype.fade=
function(a,b){var c=this,a=a?a:300,d=socialCheesecake.Grid.minOpacity,f=socialCheesecake.Grid.maxOpacity,e=1E3*(f-d)/(60*a),h=0;"out"==this.fading?(h=-1,e>this.opacity-d&&(e=this.opacity-d)):"in"==this.fading&&(h=1,e>f-this.opacity&&(e=f-this.opacity));e=this.opacity+h*e;e=Math.round(1E3*e)/1E3;c.setDivOpacity(e);"out"==this.fading&&e>d||"in"==this.fading&&e<f?requestAnimFrame(function(){c.fade(a,b)}):(this.fading="none",b&&e<=d&&c.hide())};socialCheesecake.Actor.prototype.fadeOut=function(a,b){var c=
socialCheesecake.Grid.maxOpacity;this.fading="out";this.setDivOpacity(c);this.fade(a,b)};socialCheesecake.Actor.prototype.fadeIn=function(a,b){var c=socialCheesecake.Grid.minOpacity;this.isFiltered()||(this.fading="in",this.setDivOpacity(c),b&&this.show(),this.fade(a,b))};socialCheesecake.Actor.prototype.getCheesecake=function(){return this.parents[0].parent.parent};socialCheesecake.Actor.prototype.getDiv=function(){var a=this.getCheesecake().grid.divIdPrefix;return document.getElementById(a+this.id)}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.Cheesecake=function(a){var b=a.sectors;this.center={x:a.center.x,y:a.center.y};this.rMax=a.rMax;this.sectors=[];this.highlightedSector=null;this.onSectorHighlight=a.onSectorHighlight||null;this.onSectorFocusBegin=a.onSectorFocusBegin||null;this.onSectorFocusEnd=a.onSectorFocusEnd||null;this.onSectorUnfocusBegin=a.onSectorUnfocusBegin||null;this.onSectorUnfocusEnd=a.onSectorUnfocusEnd||null;this.syncSectorFocusCallbacks=this.syncSectorFocusCallbacks||!1;this.auxiliarSectors=
[];this.stage=new Kinetic.Stage(a.container.id,a.container.width,a.container.height);this.stage.add(new Kinetic.Layer);this.stage.mainLayer=this.stage.layers[0];this.grid=new socialCheesecake.Grid({parent:this,grid_id:a.grid.id,divIdPrefix:a.grid.divIdPrefix||"actor_",maxOpacity:a.grid.maxOpacity||1,minOpacity:a.grid.minOpacity||0});this.searchEngine=new socialCheesecake.SearchEngine({parent:this});this.matchActorsNumber=a.match;null==this.matchActorsNumber&&(this.matchActorsNumber=!0);this._initialState=
{};this._changes={};this.onChange=function(){};a.onChange&&(this.onChange=a.onChange);if(a.text)for(var c in a.text)socialCheesecake.text[c]=a.text[c];if(a.colors)for(var d in a.colors)for(var f in a.colors[d])socialCheesecake.colors[d][f]=a.colors[d][f];16>b.length&&(c=new socialCheesecake.Sector({parent:this,center:this.center,label:"+",rOut:a.rMax,color:socialCheesecake.colors.extraSector.background,subsectors:[{name:"New Subsector 1"}],auxiliar:!0,type:"extraSector"}),this.sectors[b.length]=c);
c=Math.min(b.length,16);for(d=0;d<c;d++)this.sectors[d]=new socialCheesecake.Sector({parent:this,center:this.center,id:b[d].id,label:b[d].name,rOut:a.rMax,subsectors:b[d].subsectors,type:"normalSector"});this.calculatePortions();this._setInitialState();this.draw()};socialCheesecake.Cheesecake.prototype.draw=function(){this.addToLayer(this.sectors);this.stage.draw()};socialCheesecake.Cheesecake.prototype.disable=function(){var a=this.stage.layers,b;for(b in a)a[b].listen(!1)};socialCheesecake.Cheesecake.prototype.enable=
function(){var a=this.stage.layers,b;for(b in a)a[b].listen(!0)};socialCheesecake.Cheesecake.prototype.focusAndBlurCheesecake=function(a){var b=this,c,d;for(d in b.sectors)b.sectors[d]===a&&(c=d);if(null==c)throw"sector doesn't belong to this cheesecake";b.clearLayer();b.setHighlightedSector(a);var f=new socialCheesecake.Sector({parent:b,center:b.center,phi:a.phi+a.delta,delta:2*Math.PI-a.delta,rOut:b.rMax,color:socialCheesecake.colors.greySector.background,auxiliar:!0,type:"greySector"});b.auxiliarSectors.push(f);
var e=this.getAuxiliarClone(c);b.addToLayer(f);b.addToLayer(e);var h=function(){f.label="";b.unfocusAndUnblurCheesecake()},g=function(){f.click={callback:h};f.label="GO BACK"},j=function(){var a=b.grid;a.hideAll();a.show(b.sectors[c].actors);e.splitUp()};f.rotateTo({destination:5*Math.PI/4,callback:function(){f.resizeDelta({delta:3*Math.PI/2,anchor:"M",callback:g})},anchor:"M"});e.rotateTo({destination:Math.PI/4,callback:function(){var a=function(){e.resizeDelta({anchor:"M",callback:j})};if(b.onSectorFocusBegin)if(b.syncSectorFocusCallbacks)b.onSectorFocusBegin(b,
a);else b.onSectorFocusBegin(b),a();else a()},anchor:"M"})};socialCheesecake.Cheesecake.prototype.recoverCheesecake=function(){var a=this.highlightedSector,b=this.stage.mainLayer;b.getShapes();this.removeFromLayer(this.auxiliarSectors);this.auxiliarSectors=[];b.clear();this.draw();a&&(a.color=a.originalAttr.color,a.fan(!1),a.unfocus(),this.setHighlightedSector(null))};socialCheesecake.Cheesecake.prototype.unfocusAndUnblurCheesecake=function(){var a=this,b=this.auxiliarSectors,c,d,f=function(){for(var e in b)null!=
b[e].simulate?c=a.getAuxiliarClone(b[e].simulate,{phi:b[e].phi,delta:b[e].delta,rOut:b[e].rOut}):d=b[e];dummyNewDelta=a.sectors[c.simulate].delta;dummyNewPhi=a.sectors[c.simulate].phi;c.putTogether();c.resizeDelta({anchor:"M",delta:dummyNewDelta,callback:function(){if(a.onSectorUnfocusEnd)a.onSectorUnfocusEnd(a);a.grid.showAll();c.rotateTo({destination:dummyNewPhi})}});d.resizeDelta({anchor:"M",delta:2*Math.PI-dummyNewDelta,callback:function(){d.rotateTo({destination:dummyNewPhi+dummyNewDelta,callback:function(){a.recoverCheesecake()}})}})};
if(a.onSectorUnfocusBegin)if(a.syncSectorFocusCallbacks)a.onSectorUnfocusBegin(a,f);else a.onSectorUnfocusBegin(a),f();else f()};socialCheesecake.Cheesecake.prototype.addNewSector=function(){var a=this.sectors,b;b={parent:this,center:this.center,label:"New Sector",rOut:this.rMax,subsectors:[{name:"New Subsector 1"}]};a.push(a[a.length-1]);b=new socialCheesecake.Sector(b);this.sectors[a.length-2]=b;this.calculatePortions()};socialCheesecake.Cheesecake.prototype.updateActorMembership=function(a){var b=
this._changes,c=!1,d=a.id,f=a.getParentsIds(),e=a.name,a=a.extraInfo,h=this.onChange;if(void 0!=b.actors){var b=b.actors,g;for(g in b)b[g].id==d&&(c=!0,b[g].subsectors=f);c||b.push({id:d,subsectors:f,name:e,extraInfo:a,justAdded:!1})}else b.actors=[],b.actors.push({id:d,subsectors:f,name:e,extraInfo:a,justAdded:!1});h(this)};socialCheesecake.Cheesecake.prototype.calculatePortions=function(){var a=this.sectors,b=this.matchActorsNumber,c=Math.PI/8,d=Math.PI/8,f=5*Math.PI/4-c/2,e=[],h=[],g=a.length,
j=0,k=2*Math.PI;a[a.length-1].auxiliar&&(a[a.length-1].phi=f,a[a.length-1].delta=c,a[a.length-1].originalAttr.phi=a[a.length-1].phi,a[a.length-1].originalAttr.delta=a[a.length-1].delta,f+=c,g=a.length-1,k-=c);for(var c=b?k-g*d:0,i=0;i<g;i++)e[i]=a[i].actors.length,j+=e[i],h[i]=d,b||(h[i]=k/g);for(i=0;i<g;i++)h[i]=0!=j?h[i]+e[i]/j*c:k/g,a[i].phi=f,a[i].delta=h[i],a[i].originalAttr.phi=a[i].phi,a[i].originalAttr.delta=a[i].delta,f+=a[i].delta};socialCheesecake.Cheesecake.prototype.addToLayer=function(a,
b){b=b||this.stage.mainLayer;if(a instanceof Array)for(var c in a)b.add(a[c].getRegion());else b.add(a.getRegion())};socialCheesecake.Cheesecake.prototype.removeFromLayer=function(a,b){b=b||this.stage.mainLayer;if(a instanceof Array)for(var c in a)try{b.remove(a[c].getRegion())}catch(d){}else b.remove(a.getRegion())};socialCheesecake.Cheesecake.prototype.drawLayer=function(a){a=a||this.stage.mainLayer;a.draw()};socialCheesecake.Cheesecake.prototype.clearLayer=function(a){for(var a=a||this.stage.mainLayer,
b=a.getShapes(),c=b.length-1;0<=c;c--)a.remove(b[c]);a.clear()};socialCheesecake.Cheesecake.prototype.setHighlightedSector=function(a){if(this.highlightedSector!=a&&(this.highlightedSector=a,this.onSectorHighlight))this.onSectorHighlight(this)};socialCheesecake.Cheesecake.prototype.getAuxiliarClone=function(a,b){var c=null,d=null,d=this.auxiliarSectors,f={},b=b||{},e;for(e in d)null!=d[e].simulate&&(c=d[e]);if(null!=a){d=this.sectors[a];f={phi:b.phi||d.phi,delta:b.delta||d.delta,rOut:b.rOut||d.rOut,
label:b.label||d.label,borderColor:b.borderColor||socialCheesecake.colors[d.type].border,color:b.color||d.color,fontColor:b.fontColor||socialCheesecake.colors[d.type].font,simulate:a,auxiliar:!0,type:"dummySector"};c||(c=new socialCheesecake.Sector({center:this.center,parent:this}),this.auxiliarSectors.push(c));for(var h in f)c[h]=f[h]}return c};socialCheesecake.Cheesecake.prototype.getFocusedSector=function(){var a=this.getAuxiliarClone(),b=this.sectors,c=null;a&&(c=b[a.simulate]);return c};socialCheesecake.Cheesecake.prototype.getSectorById=
function(a){var b=this.sectors,c,d;for(d in b)if(b[d].id==a){c=b[d];break}return c};socialCheesecake.Cheesecake.prototype.getSubsectorById=function(a){var b=this.sectors,c,d,f;for(f in b){c=b[f].subsectors;for(var e in c)if(c[e].id==a){d=c[e];break}}return d};socialCheesecake.Cheesecake.prototype.getChanges=function(){return this._changes};socialCheesecake.Cheesecake.prototype.getInitialState=function(){return this._initialState};socialCheesecake.Cheesecake.prototype._setInitialState=function(){var a=
this._initialState,b=this.grid.actors;a.actors=[];for(var c in b)a.actors.push({id:b[c].id,subsectors:b[c].getParentsIds(),name:b[c].name,extraInfo:b[c].extraInfo})}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.colors={normalSector:{background:"#FEEEBD",border:"#D19405",font:"#D19405",click:"#FFE481",mouseover:"#FFE481",mouseup:"#FEEEBD",mouseout:"#FEEEBD"},extraSector:{background:"#FFBABA",border:"#BD1823",font:"#BD1823",click:"#FF5964",mouseover:"#FF5964",mouseup:"#FFBABA",mouseout:"#FFBABA"},greySector:{background:"#f5f5f5",click:"#f5f5f5",mouseover:"#f5f5f5",mouseout:"#f5f5f5",mouseup:"#f5f5f5",font:"#666",border:"#666"}};socialCheesecake.colors.normalSubsector=socialCheesecake.colors.normalSector;
socialCheesecake.colors.extraSubsector=socialCheesecake.colors.extraSector;socialCheesecake.colors.greySubsector=socialCheesecake.colors.greySector})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.eventCallbackHandlers={normalSector:{mouseover:function(a){var b=a.getCheesecake();document.body.style.cursor="pointer";b.grid.focus(a.actors);a.focus();null!=b.highlightedSector?b.highlightedSector.fan(!1,function(){a.fan(!0)}):a.fan(!0);b.setHighlightedSector(a)},mouseout:function(a){var b=a.getCheesecake();document.body.style.cursor="default";b.grid.unfocusAll();a.unfocus();b.setHighlightedSector(null);a.fan(!1)},click:function(a){var b=a.getCheesecake();b.focusAndBlurCheesecake(a);
b.grid.unfocus(a.actors)}},extraSector:{mouseover:function(a){a.getCheesecake();document.body.style.cursor="pointer";a.focus()},mouseout:function(a){a.getCheesecake();document.body.style.cursor="default";a.unfocus()},click:function(a){var b=a.getCheesecake();b.focusAndBlurCheesecake(a);b.addNewSector()}},greySector:{mouseout:function(){document.body.style.cursor="default"},click:function(){},mouseup:function(){},mouseover:function(){document.body.style.cursor="pointer"}},normalSubsector:{mouseover:function(a){var b=
a.getCheesecake();document.body.style.cursor="pointer";1>a.parent.subsectors.length&&b.grid.focus(a.actors);b.setHighlightedSector(a)},mouseout:function(a){var b=a.getCheesecake();document.body.style.cursor="default";1>a.parent.subsectors.length&&b.grid.unfocus(a.actors);b.setHighlightedSector(a.parent)},click:function(a){var b=a.getCheesecake().grid.getSelectedActors();0<b.length&&a.changeMembership(b)},mouseup:function(){}},extraSubsector:{mouseover:function(a){a.resizeWidth({width:1.5*(a.originalAttr.rOut-
a.originalAttr.rIn),anchor:"m",step:1})},mouseout:function(a){a.resizeWidth({width:a.originalAttr.rOut-a.originalAttr.rIn,anchor:0==a.rIn?"rin":"m",step:1,priority:!0})},click:function(a){a.parent.turnExtraIntoNewSubsector(a.simulate)},mouseup:function(){}}}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.Grid=function(a){if(!a)throw"No arguments passed to the function";this.actors=[];this.parent=a.parent;this.id=a.grid_id;this.divIdPrefix=a.divIdPrefix;socialCheesecake.Grid.maxOpacity=a.maxOpacity;socialCheesecake.Grid.minOpacity=a.minOpacity};socialCheesecake.Grid.prototype.addActor=function(a,b){var c=this.actors,d,f=!1,e;for(e in c)if(c[e].id==a.id){f=!0;d=c[e];var h=!1,g;for(g in d.parents)d.parents[g]==b&&(h=!0);h||d.parents.push(b)}f||(a.parent=b,d=new socialCheesecake.Actor(a),
c.push(d));return d};socialCheesecake.Grid.prototype.removeActor=function(a){var b=this.actors,c;for(c in b)b[c].id==a.id&&0>=a.parents.length&&b.splice(c,1)};socialCheesecake.Grid.prototype.getActor=function(a){var b=this.actors,c;for(c in b)if(this.actors[c].id==a)return this.actors[c];return null};socialCheesecake.Grid.prototype.getSelectedActors=function(){var a=this.actors,b=[],c;for(c in a)a[c]&&a[c].isSelected()&&b.push(a[c]);return b};socialCheesecake.Grid.prototype.select=function(a){var b;
if(a instanceof Array)for(var c in a){if(b=a[c])b instanceof socialCheesecake.Actor||(b=this.getActor(b)),b.select()}else b=a,a instanceof socialCheesecake.Actor||(b=this.getActor(a)),b.select()};socialCheesecake.Grid.prototype.selectAll=function(){this.select(this.actors)};socialCheesecake.Grid.prototype.unselect=function(a){var b;if(a instanceof Array)for(var c in a){if(b=a[c])b instanceof socialCheesecake.Actor||(b=this.getActor(b)),b.unselect()}else b=a,a instanceof socialCheesecake.Actor||(b=
this.getActor(a)),b.unselect()};socialCheesecake.Grid.prototype.unselectAll=function(){this.unselect(this.actors)};socialCheesecake.Grid.prototype.focus=function(a){var b;if(a instanceof Array)for(var c in a){if(b=a[c])b instanceof socialCheesecake.Actor||(b=this.getActor(b)),b.focus()}else b=a,a instanceof socialCheesecake.Actor||(b=this.getActor(a)),b.focus()};socialCheesecake.Grid.prototype.focusAll=function(){this.focus(this.actors)};socialCheesecake.Grid.prototype.hide=function(a,b){var c;if(a instanceof
Array)for(var d in a){if(c=a[d])c instanceof socialCheesecake.Actor||(c=this.getActor(c)),(!c.isSelected()||b)&&c.hide()}else c=a instanceof socialCheesecake.Actor?a:this.getActor(a),c.hide()};socialCheesecake.Grid.prototype.hideAll=function(){this.hide(this.actors)};socialCheesecake.Grid.prototype.show=function(a,b){var c;if(a instanceof Array)for(var d=0;d<a.length;d++)c=a[d],c instanceof socialCheesecake.Actor||(c=this.getActor(c)),(!c.isSelected()||b)&&c.show();else c=a instanceof socialCheesecake.Actor?
a:this.getActor(a),(!c.isSelected()||b)&&c.show()};socialCheesecake.Grid.prototype.showAll=function(){this.show(this.actors)};socialCheesecake.Grid.prototype.unfocus=function(a){var b;if(a instanceof Array)for(var c in a)b=a[c],b instanceof socialCheesecake.Actor||(b=this.getActor(b)),b.unfocus();else b=a,a instanceof socialCheesecake.Actor||(b=this.getActor(a)),b.unfocus()};socialCheesecake.Grid.prototype.unfocusAll=function(){this.unfocus(this.actors)};socialCheesecake.Grid.prototype.fadeOut=function(a,
b,c,d){var f;if(a instanceof Array)for(var e in a){if(f=a[e])f instanceof socialCheesecake.Actor||(f=this.getActor(f)),(!f.isSelected()||d)&&f.fadeOut(b,c)}else f=a instanceof socialCheesecake.Actor?a:this.getActor(a),(!f.isSelected()||d)&&f.fadeOut(b,c)};socialCheesecake.Grid.prototype.fadeOutAll=function(a,b){this.fadeOut(this.actors,a,b)};socialCheesecake.Grid.prototype.fadeIn=function(a,b,c,d){var f;if(a instanceof Array)for(var e=0;e<a.length;e++)f=a[e],f instanceof socialCheesecake.Actor||(f=
this.getActor(f)),(!f.isSelected()||d)&&f.fadeIn(b,c);else f=a instanceof socialCheesecake.Actor?a:this.getActor(a),(!f.isSelected()||d)&&f.fadeIn(b,c)};socialCheesecake.Grid.prototype.fadeInAll=function(a,b){this.fadeIn(this.actors,a,b)}})();socialCheesecake=socialCheesecake||{};(function(){socialCheesecake.SearchEngine=function(a){this.parent=a.parent};socialCheesecake.SearchEngine.prototype.filter=function(a){var b=this.parent.grid.actors,a=RegExp(a.toLowerCase()),c;for(c in b){var d=b[c];d.name.toLowerCase().match(a)?d.unfilter():d.filter()}this.parent.highlightedSector?this.parent.grid.fadeIn(this.parent.highlightedSector.actors,100,!0):this.parent.grid.fadeIn(this.parent.grid.actors,100,!0)}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.Sector=function(a){var b={center:{x:0,y:0},rIn:0,rOut:300,delta:Math.PI/2,phi:0,label:"",color:socialCheesecake.colors.normalSector.background,auxiliar:!1,type:"normalSector"};a||(a=b);for(var c in b)if(!(c in a)||void 0===a[c])a[c]=b[c];for(a.phi%=2*Math.PI;0>a.phi;)a.phi+=2*Math.PI;if(0>=a.delta||a.delta>2*Math.PI)throw"Delta must be greater than 0 and less than 2*pi";a.id&&(this.id=a.id);this.x=a.center.x;this.y=a.center.y;this.rOut=a.rOut;this.rIn=a.rIn;this.phi=a.phi;
this.delta=a.delta;this.label=a.label;this.color=a.color;a.fontColor&&(this.fontColor=a.fontColor);a.borderColor&&(this.borderColor=a.borderColor);a.mouseover&&(this.mouseover=a.mouseover);a.mouseup&&(this.mouseup=a.mouseup);a.mouseout&&(this.mouseout=a.mouseout);a.click&&(this.click=a.click);this.subsectors=[];this.extraSubsectors=[];this.actors=[];null!=a.parent&&(this.parent=a.parent);null!=a.simulate&&(this.simulate=a.simulate);this.auxiliar=a.auxiliar;this.type=a.type;if(null!=a.subsectors)for(var d in a.subsectors)this.subsectors.push(new socialCheesecake.Subsector({id:a.subsectors[d].id,
label:a.subsectors[d].name,parent:this,x:this.x,y:this.y,phi:null,delta:null,rIn:null,rOut:null,actors:a.subsectors[d].actors,color:socialCheesecake.colors.normalSector.background}));this.originalAttr={x:this.x,y:this.y,phi:this.phi,delta:this.delta,rIn:this.rIn,rOut:this.rOut,color:this.color,label:this.label,simulate:this.simulate,subsectors:this.subsectors,auxiliar:this.auxiliar,type:this.type};this._region=null};socialCheesecake.Sector.prototype._draw=function(a){var b=this.x,c=this.y,d=this.phi,
f=this.delta,e=this.rIn,h=this.rOut,g=this.color,j=this.label,k=this.actors,i=this.type,l=this.fontColor||socialCheesecake.colors[i].font;a.restore();a.save();a.beginPath();a.arc(b,c,h,-d,-(d+f),!0);a.lineTo(b+e*Math.cos(-d-f),c+e*Math.sin(-d-f));a.arc(b,c,e,-(d+f),-d,!1);a.closePath();a.fillStyle=g;a.fill();a.lineWidth=2;a.strokeStyle=this.borderColor||socialCheesecake.colors[i].border;a.stroke();this.auxiliar&&"+"==j?socialCheesecake.text.addPlusCharacter(a,b,c,0.5*(h-e)+e,d,f,l):this.parent.auxiliar&&
"+"==this.parent.label?socialCheesecake.text.writeCurvedText(j,a,b,c,0.7*(h-e)+e,d,f,l,"newStyle"):socialCheesecake.text.writeCurvedText(j,a,b,c,0.7*(h-e)+e,d,f,l);this.auxiliar||socialCheesecake.text.writeCurvedText("("+k.length+")",a,b,c,0.55*(h-e)+e,d,f,l)};socialCheesecake.Sector.prototype.getRegion=function(){if(null==this._region){var a=this;a._region=new Kinetic.Shape(function(){var b=this.getContext();a._draw(b)},a.label);a._region.on("mouseover",function(){a.eventHandler("mouseover")});a._region.on("mouseout",
function(){a.eventHandler("mouseout")});a._region.on("click",function(){a.eventHandler("click")});a._region.on("mouseup",function(){a.eventHandler("mouseup")})}return this._region};socialCheesecake.Sector.prototype.eventHandler=function(a){this.colorHandler(a);this.callbackHandler(a)};socialCheesecake.Sector.prototype.colorHandler=function(a){var b=this.type;null!=this[a]&&null!=this[a].color?this.changeColor(this[a].color):socialCheesecake.colors[b]&&socialCheesecake.colors[b][a]&&this.changeColor(socialCheesecake.colors[b][a])};
socialCheesecake.Sector.prototype.callbackHandler=function(a){var b=this.type;if(null!=this[a]&&null!=this[a].callback)this[a].callback(this);else if(socialCheesecake.eventCallbackHandlers[b]&&socialCheesecake.eventCallbackHandlers[b][a])socialCheesecake.eventCallbackHandlers[b][a](this)};socialCheesecake.Sector.prototype.getCheesecake=function(){return this.parent};socialCheesecake.Sector.prototype.turnExtraIntoNewSubsector=function(a){var b=this,c=this.getCheesecake(),d=this.extraSubsectors.concat(this.subsectors),
f=[],e=[],h="m",g;for(g in d){var j={label:d[g].label,x:d[g].x,y:d[g].y,rIn:d[g].rIn,rOut:d[g].rOut,phi:d[g].phi,delta:d[g].delta,type:d[g].type,auxiliar:d[g].auxiliar||null,parent:d[g].parent,color:d[g].color};g<this.extraSubsectors.length?(e.push(new socialCheesecake.Subsector(j)),e[g].listen(!1)):(f.push(new socialCheesecake.Subsector(j)),f[g-e.length].listen(!1))}c.addToLayer(f.concat(e));c.removeFromLayer(d);this.addNewSubsector(a);var k=this.subsectors;this.extraSubsectors=[];var i=b.extraSubsectors,
l=this.getCheesecake().getAuxiliarClone();l.calculateSubportions();l.label="";for(g in e)g!=a&&e[g].resizeWidth({width:0,anchor:"m",step:1.5});var d=function(){for(var b=0;b<f.length;b++)f[b].changeMediumRadius({radius:b<a?k[b].getMediumRadius():k[b+1].getMediumRadius(),step:1.5});e[a].type="normalSubsector";e[a].color=k[a].color;e[a].label="";0==a?h="rin":a==e.length-1&&(h="rout");e[a].resizeWidth({width:"m"==h||0==i.length?k[a].getWidth():i[a].getWidth()+k[a].getWidth(),anchor:h,step:1.5,callback:n})},
n=function(){e[a].label=k[a].label;e[a].changeMediumRadius({radius:k[a].getMediumRadius(),step:1.5,callback:4<=k.length?m:function(){}});if(4>k.length){b.createExtraSubsectors();l.calculateSubportions();i=b.extraSubsectors;var d={label:"+",x:i[a].x,y:i[a].y,phi:e[a].phi,delta:e[a].delta,type:"extraSubsector",auxiliar:!0,parent:e[a].parent,color:i[a].color};e.push(new socialCheesecake.Subsector(d));e.push(new socialCheesecake.Subsector(d));for(d=0;d<e.length;d++){var f=!1;d!=a&&(e[d].rIn=d<a?i[d].getMediumRadius():
i[d-1].getMediumRadius(),e[d].rOut=e[d].rIn,c.addToLayer(e[d]),e[d].resizeWidth({width:d<a?i[d].getWidth():i[d-1].getWidth(),anchor:"m",step:1.5,callback:!f?function(){m();f=!0}:function(){}}))}}},m=function(){c.removeFromLayer(f.concat(e));c.addToLayer(k);i&&c.addToLayer(i);c.drawLayer()};for(g=0;g<f.length;g++)f[g].resizeWidth({width:g<a?k[g].getWidth():k[g+1].getWidth(),anchor:"m",step:1.5,callback:0==g?d:function(){}})};socialCheesecake.Sector.prototype.splitUp=function(){var a=this.getCheesecake(),
b=a.onSectorFocusEnd,c=null!=this.simulate?a.sectors[this.simulate]:this,d=c.subsectors;4>d.length&&c.createExtraSubsectors();this.calculateSubportions();a.addToLayer(d.concat(c.extraSubsectors));a.drawLayer();b&&b(a)};socialCheesecake.Sector.prototype.putTogether=function(){var a=this.getCheesecake(),b=null!=this.simulate?a.sectors[this.simulate]:this;a.removeFromLayer(b.subsectors.concat(b.extraSubsectors));b.extraSubsectors=[]};socialCheesecake.Sector.prototype.createExtraSubsectors=function(){var a=
this.getCheesecake(),b=this.subsectors,c=this.extraSubsectors||[],a={x:a.center.x,y:a.center.y,label:"+",parent:this,auxiliar:!0,color:socialCheesecake.colors.extraSector.background,type:"extraSubsector"};c.splice(0,c.length);for(var d=0;d<b.length+1;d++){a.simulate=d;var f=new socialCheesecake.Subsector(a);c.push(f)}};socialCheesecake.Sector.prototype.calculateSubportions=function(){var a=this.getCheesecake(),b=null!=this.simulate?a.sectors[this.simulate]:this,a=b.subsectors,b=b.extraSubsectors,
c=this.phi,d=this.delta,f=this.rOut,e=this.rIn,h=b.length==a.length+1?0.06*(f-e):0,f=(f-e-b.length*h)/a.length,g;for(g in a)e+=h,a[g].rIn=e,a[g].originalAttr.rIn=a[g].rIn,a[g].rOut=e+f,a[g].originalAttr.rOut=a[g].rOut,a[g].phi=c,a[g].originalAttr.phi=a[g].phi,a[g].delta=d,a[g].originalAttr.delta=a[g].delta,e+=f;e=this.rIn;for(g in b)b[g].rIn=e,b[g].originalAttr.rIn=b[g].rIn,b[g].rOut=e+h,b[g].originalAttr.rOut=b[g].rOut,b[g].delta=d,b[g].originalAttr.delta=b[g].delta,b[g].phi=c,b[g].originalAttr.phi=
b[g].phi,e+=h+f};socialCheesecake.Sector.prototype.changeColor=function(a){this.changeProperty("color",a)};socialCheesecake.Sector.prototype.changeLabel=function(a){this.changeProperty("label",a)};socialCheesecake.Sector.prototype.changeProperty=function(a,b){var c=this.getCheesecake().stage,d=c.mainLayer.getContext();this[a]=b;d.restore();d.save();c.draw()};socialCheesecake.Sector.prototype.resizeDelta=function(a){if(!a)throw"No arguments passed to the function";var b=this,c=b.getCheesecake().stage,
d=c.mainLayer.getContext(),f=b.delta,e=b.phi,h=0.05,g=Math.PI/2,j=1,k=!0,i=0;a.step&&(h=a.step);a.delta&&(g=a.delta);if(a.anchor){if("b"==a.anchor.toLowerCase()||"beginning"==a.anchor)j=0;if("m"==a.anchor.toLowerCase()||"middle"==a.anchor)j=0.5;if("e"==a.anchor.toLowerCase()||"end"==a.anchor)j=1}f>g?(f-g<h&&(h=f-g),f-=h,e+=j*h,i=-1):f<g&&(g-f<h&&(h=g-f),f+=h,e-=j*h,i=1);a.priority&&(b.growDelta=i);null!=b.growDelta&&i!=b.growDelta?k=!1:(k=!0,b.growDelta=i);b.delta=f;b.phi=e;d.restore();d.save();c.draw();
k&&Math.round(1E3*f)!=Math.round(1E3*g)?requestAnimFrame(function(){b.resizeDelta(a)}):(b.growDelta=null,a.callback&&a.callback())};socialCheesecake.Sector.prototype.resizeWidth=function(a){var b=this,c=b.getCheesecake().stage,d=c.mainLayer.getContext(),f=this.rIn,e=this.rOut,h=e-f,g=0.05,j=h,k=1,i=0,l=!0;a.step&&(g=a.step);null!=a.width&&(j=a.width);if(0>j)throw"Width must be greater than or equal to zero";if(a.anchor){if("i"==a.anchor.toLowerCase()||"in"==a.anchor||"rin"==a.anchor.toLowerCase())k=
1;if("m"==a.anchor.toLowerCase()||"middle"==a.anchor)k=0.5;if("o"==a.anchor.toLowerCase()||"out"==a.anchor||"rout"==a.anchor.toLowerCase())k=0}h>j?(h-j<g&&(g=h-j),i=-1):h<j&&(j-h<g&&(g=j-h),i=1);a.priority&&(b.grow=i);null!=b.grow&&i!=b.grow?l=!1:(l=!0,b.grow=i);e+=i*k*g;f-=i*(1-k)*g;h=e-f;0>f&&(e+=this.rIn-f,f=0);0>=h&&b.getCheesecake().removeFromLayer(b);b.rOut=e;b.rIn=f;d.restore();d.save();c.draw();l&&Math.round(1E3*h)!=Math.round(1E3*j)?requestAnimFrame(function(){b.resizeWidth(a)}):(b.grow=
null,a.callback&&a.callback())};socialCheesecake.Sector.prototype.changeMediumRadius=function(a){var b=this,c=this.rIn,d=this.rOut,f=this.getMediumRadius();0>a.radius-this.getWidth()/2&&(a.radius=this.getWidth()/2);var e=a.radius||f,h=a.step||0.05,g=this.getCheesecake().stage.mainLayer.getContext();e>f?(e-f<h&&(h=e-f),c+=h,d+=h):(f-e<h&&(h=f-e),c-=h,d-=h);this.rIn=Math.round(1E3*c)/1E3;this.rOut=Math.round(1E3*d)/1E3;f=this.getMediumRadius();g.restore();g.save();this.getCheesecake().stage.draw();
Math.round(1E3*f)!=Math.round(1E3*e)?requestAnimFrame(function(){b.changeMediumRadius(a)}):a.callback&&a.callback()};socialCheesecake.Sector.prototype.focus=function(){var a=this.getCheesecake().stage,b=a.mainLayer.getContext();this.rOut=1.05*this.originalAttr.rOut;b.restore();b.save();a.draw()};socialCheesecake.Sector.prototype.unfocus=function(){var a=this.getCheesecake().stage,b=a.mainLayer.getContext();this.rOut=this.originalAttr.rOut;b.restore();b.save();a.draw()};socialCheesecake.Sector.prototype.fan=
function(a,b){var c=Math.PI/5;a&&this.delta>=c||(a?(this.getRegion().moveToTop(),this.resizeDelta({anchor:"m",delta:c,callback:b})):this.resizeDelta({anchor:"m",delta:this.originalAttr.delta,priority:!0,callback:b}))};socialCheesecake.Sector.prototype.rotateTo=function(a){var b=this,c=this.phi%(2*Math.PI),d=this.delta,f=0.05,e=0,h=b.getCheesecake().stage,g=b.getRegion().getLayer().getContext();if(!a)throw"No arguments passed to the function";a.step&&(f=a.step);if(null==a.destination)throw"destination must be defined";
if(a.anchor){if("b"==a.anchor.toLowerCase()||"beginning"==a.anchor)e=0;if("m"==a.anchor.toLowerCase()||"middle"==a.anchor)e=0.5;if("e"==a.anchor.toLowerCase()||"end"==a.anchor)e=1}for(d=(a.destination-e*d)%(2*Math.PI);0>d;)d+=2*Math.PI;for(;0>c;)c+=2*Math.PI;e=0;d>c?e=1:d<c&&(e=-1);Math.round(1E3*(2*Math.PI-Math.abs(d-c)))/1E3>=Math.round(1E3*Math.abs(d-c))/1E3?(Math.abs(d-c)<f&&(f=Math.abs(d-c)),c+=e*f):(2*Math.PI-Math.abs(d-c)<f&&(f=2*Math.PI-Math.abs(d-c)),d-=2*e*Math.PI,c-=e*f);b.phi=c;g.restore();
g.save();h.draw();0.0010<Math.abs(c-d)?(b.phi=c%(2*Math.PI),requestAnimFrame(function(){b.rotateTo({context:g,destination:a.destination,step:f,callback:a.callback,anchor:a.anchor})})):a.callback&&a.callback()};socialCheesecake.Sector.prototype.addNewSubsector=function(a){for(var b=this.subsectors,c={parent:this,x:this.x,y:this.y,delta:this.delta,phi:this.phi},d=b.length;0<=d;d--)d>a&&(b[d]=b[d-1]),d==a&&(c.label="New Subsector "+d,b[d]=new socialCheesecake.Subsector(c));return b[a]};socialCheesecake.Sector.prototype.addActor=
function(a,b){var c=this.actors,d,f=!1,e;for(e in c)if(c[e].id==a.id){f=!0;d=c[e];var h=!1,g;for(g in d.parents)d.parents[g]==b&&(h=!0);h||d.parents.push(b)}f||(d=this==b?this.parent.addActor(a,b):this.parent.grid.addActor(a,b),c.push(d));return d};socialCheesecake.Sector.prototype.removeActor=function(a){var b=this.actors,c,d=!1,f;for(f in b)if(b[f].id==a.id){c=a.parents;for(var e in c)for(var h in this.subsectors)if(c[e]===this.subsectors[h]){d=!0;break}d||b.splice(f,1)}};socialCheesecake.Sector.prototype.getWidth=
function(){return this.rOut-this.rIn};socialCheesecake.Sector.prototype.getMediumRadius=function(){return(this.rOut+this.rIn)/2};socialCheesecake.Sector.prototype.listen=function(a){var b=this.getRegion(),c=this;void 0===a&&(a=!0);a?(b.on("mouseover",function(){c.eventHandler("mouseover")}),b.on("mouseout",function(){c.eventHandler("mouseout")}),b.on("click",function(){c.eventHandler("click")}),b.on("mouseup",function(){c.eventHandler("mouseup")})):(b.off("mouseover"),b.off("mouseout"),b.off("click"),
b.off("mouseup"))}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.Subsector=function(a){this.id=a.id||null;null!=a.parent&&(this.parent=a.parent);this.label="";null!=a.label&&(this.label=a.label);this.x=a.x;this.y=a.y;this.rOut=a.rOut;this.rIn=a.rIn;this.phi=a.phi;this.delta=a.delta;this.actors=[];this.auxiliar=a.auxiliar?a.auxiliar:!1;this.type=a.type?a.type:"normalSubsector";null!=a.simulate&&(this.simulate=a.simulate);a.color&&(this.color=a.color);a.fontColor&&(this.fontColor=a.fontColor);a.borderColor&&(this.borderColor=a.borderColor);
null!=a.click&&(this.click=a.click);null!=a.mouseup&&(this.mouseup=a.mouseup);null!=a.mouseover&&(this.mouseover=a.mouseover);null!=a.mouseout&&(this.mouseout=a.mouseout);this.getCheesecake();if(a.actors)for(var b in a.actors)this.addActor({id:a.actors[b][0],name:a.actors[b][1],extraInfo:a.actors[b][2]},this);this.originalAttr={x:this.x,y:this.y,phi:this.phi,delta:this.delta,rIn:this.rIn,rOut:this.rOut,color:this.color,fontColor:this.fontColor,borderColor:this.borderColor,label:this.label,auxiliar:this.auxiliar,
type:this.type,simulate:this.simulate}};socialCheesecake.Subsector.prototype=new socialCheesecake.Sector({id:this.id,parent:this.parent,center:{x:this.x,y:this.y},label:this.label,rIn:this.rIn,rOut:this.rOut,phi:this.phi,delta:this.delta,auxiliar:this.auxiliar,color:this.color,fontColor:this.fontColor,borderColor:this.borderColor,type:this.type,simulate:this.simulate,mouseover:this.mouseover,mouseout:this.mouseout,mouseup:this.mouseup,click:this.click});socialCheesecake.Subsector.prototype.getCheesecake=
function(){return this.parent.parent};socialCheesecake.Subsector.prototype.removeActor=function(a){var b=this.actors,c,d;for(d in b)if(b[d].id==a.id){c=a.parents;for(var f in c)c[f]===this&&c.splice(f,1);b.splice(d,1);this.parent.removeActor(a)}};socialCheesecake.Subsector.prototype.changeMembership=function(a){var b=this.actors,c;c=!1;for(var d in a){for(var f in b)if(b[f].id==a[d].id){c=!0;this.removeActor(a[d]);break}c||(c={id:a[d].id},this.addActor(c,this));this.getCheesecake().updateActorMembership(a[d]);
c=!1}this.getCheesecake().calculatePortions()}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.text={style:"bold 14px sans-serif",newStyle:"bold 14px sans-serif",addPlusCharacter:function(a,b,c,d,f,e,h,g){a.font=g&&socialCheesecake.text[g]?socialCheesecake.text[g]:socialCheesecake.text.style;a.fillStyle=h||"#000";a.textAlign="center";a.textBaseline="middle";text="+";a.translate(b,c);a.rotate(-e/2-f-Math.PI/2);a.fillText(text[0],0,d);a.restore();a.save()},writeCurvedText:function(a,b,c,d,f,e,h,g,j){b.font=j&&socialCheesecake.text[j]?socialCheesecake.text[j]:socialCheesecake.text.style;
b.fillStyle=g||"#000";b.textBaseline="middle";for(var g=Math.tan(b.measureText(a).width/(a.length*f)),j=null,k=a;g*(a.length+4)>h;){if(j==a){console.log("WARNING: Infinite loop detected and stopped. Text '"+k+"' failed to be correctly truncated. Proccesed serveral times as '"+a+"' and will be returned as '"+words[0].substring(0,h/g-7)+"'. Space too small to even be able to truncate.");a=words[0].substring(0,h/g-7);break}else j=a;words=a.split(" ");1<words.length?(words.splice(words.length-1,1),a=
words.join(" ")+"..."):a=words[0].substring(0,h/g-7)+"...";g=Math.tan(b.measureText(a).width/(a.length*f))}b.translate(c,d);c=0;e+h/2>=Math.PI&&e+h/2<2*Math.PI?(c=-1,b.rotate(-(h-g*a.length)/2-e-Math.PI/2)):(c=1,b.rotate((h-g*a.length)/2+Math.PI/2-h-e));for(e=0;e<a.length;e++)b.fillText(a[e],0,-(c*f)),h=Math.tan(b.measureText(a[e]).width/f),b.rotate(c*h);b.restore();b.save()},writeCenterText:function(a,b,c,d){b.fillText(a,c-b.measureText(a).width/2,d)}}})();
