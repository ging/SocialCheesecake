var socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.text={writeCurvedText:function(a,b,c,e,d,f,g){b.font="bold 14px sans-serif";b.fillStyle="#000";b.textBaseline="middle";var h=Math.tan(b.measureText(a).width/(a.length*d));if(h*a.length<=g){b.translate(c,e);c=0;f+g/2>=Math.PI&&f+g/2<2*Math.PI?(c=-1,b.rotate(-(g-h*a.length)/2-f-Math.PI/2)):(c=1,b.rotate((g-h*a.length)/2+Math.PI/2-g-f));for(f=0;f<a.length;f++)b.fillText(a[f],0,-(c*d)),g=Math.tan(b.measureText(a[f]).width/d),b.rotate(c*g);return!0}return!1},writeCenterText:function(a,
b,c,e){b.fillText(a,c-b.measureText(a).width/2,e)}}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.Sector=function(a){var b={center:{x:0,y:0},rIn:0,rOut:300,delta:Math.PI/2,phi:0,label:"",color:"#eeffee",mouseover:{color:"#aaffaa"},mouseout:{color:"#eeffee"},mouseup:{color:"#77ff77"},mousedown:{color:"#aaffaa"}},c;for(c in b)c in a||(a[c]=b[c]);if(0>a.phi||a.phi>2*Math.PI)throw"Phi must be greater or equal to 0 and less than 2*pi";if(0>=a.delta||a.delta>2*Math.PI)throw"Delta must be greater than 0 and less than 2*pi";this.x=a.center.x;this.y=a.center.y;this.rOut=a.rOut;
this.rIn=a.rIn;this.phi=a.phi;this.delta=a.delta;this.label=a.label;this.color=a.color;this.mouseover=a.mouseover;this.mouseup=a.mouseup;this.mouseout=a.mouseout;this.mousedown=a.mousedown;this.subsectors=[];this.actors=[];if(null!=a.parent)this.parent=a.parent;if(null!=a.simulate)this.simulate=a.simulate;if(null!=a.subsectors){b=this.rIn;c=(this.rOut-this.rIn)/a.subsectors.length;for(var e in a.subsectors){var d=b+c,f=new socialCheesecake.Subsector({label:a.subsectors[e].name,parent:this,x:this.x,
y:this.y,phi:this.phi,delta:this.delta,rIn:b,rOut:d,actors:a.subsectors[e].actors}),b=d;this.subsectors.push(f)}}this.originalAttr={x:this.x,y:this.y,phi:this.phi,delta:this.delta,rIn:this.rIn,rOut:this.rOut,color:this.color,label:this.label,mouseover:this.mouseover,mouseout:this.mouseout,mousedown:this.mousedown,mouseup:this.mouseup,simulate:this.simulate,subsectors:this.subsectors};this._region=null};socialCheesecake.Sector.prototype._draw=function(a,b){var c=this.x,e=this.y,d=this.phi,f=this.delta,
g=this.rIn,h=this.rOut,i=this.color,j=this.label;if(null!=b){if(null!=b.x)c=b.x;if(null!=b.y)e=b.y;if(null!=b.phi)d=b.phi;if(null!=b.delta)f=b.delta;if(null!=b.rIn)g=b.rIn;if(null!=b.rOut)h=b.rOut;if(null!=b.color)i=b.color;if(null!=b.label)j=b.label}a.restore();a.save();a.beginPath();a.arc(c,e,h,-d,-(d+f),!0);a.lineTo(c+g*Math.cos(-d-f),e+g*Math.sin(-d-f));a.arc(c,e,g,-(d+f),-d,!1);a.closePath();a.fillStyle=i;a.fill();a.lineWidth=4;a.stroke();socialCheesecake.text.writeCurvedText(j,a,c,e,(h+g)/2,
d,f)};socialCheesecake.Sector.prototype.getRegion=function(){if(null==this._region){var a=this;a._region=new Kinetic.Shape(function(){var b=this.getContext();a._draw(b)});a._region.addEventListener("mouseover",function(){a.eventHandler("mouseover")});a._region.addEventListener("mouseout",function(){a.eventHandler("mouseout")});a._region.addEventListener("mousedown",function(){a.eventHandler("mousedown")});a._region.addEventListener("mouseup",function(){a.eventHandler("mouseup")})}return this._region};
socialCheesecake.Sector.prototype.eventHandler=function(a){null!=this[a]&&(null!=this[a].color&&this.changeColor(this[a].color),null!=this[a].callback&&this[a].callback(this))};socialCheesecake.Sector.prototype.getCheesecake=function(){return this.parent};socialCheesecake.Sector.prototype.splitUp=function(){var a=this.getCheesecake(),b=this.phi,c=this.delta,e=this.rOut,d=this.rIn,f=(null!=this.simulate?a.sectors[this.simulate]:this).subsectors,g=0;0<f.length&&(g=(e+d)/f.length);for(var h in f)f[h].rIn=
d,f[h].rOut=d+g,f[h].phi=b,f[h].delta=c,a.stage.add(f[h].getRegion()),d+=g};socialCheesecake.Sector.prototype.putTogether=function(){var a=this.getCheesecake(),b;null!=this.simulate?b=a.sectors[this.simulate]:b=this;b=b.subsectors;for(var c in b)a.stage.remove(b[c].getRegion())};socialCheesecake.Sector.prototype.changeColor=function(a){if(this.getRegion()){console.log(this.getRegion());var b=this.getRegion().layer.getContext(),c=this.getCheesecake().stage;this.color=a;b.restore();b.save();c.draw()}};
socialCheesecake.Sector.prototype.resize=function(a){if(!a)throw"No arguments passed to the function";var b=this,c=b.getRegion().layer.getContext(),e=b.getCheesecake().stage,d=b.delta,f=b.phi,g=0.05,h=Math.PI/2,i=1;if(a.step)g=a.step;if(a.delta)h=a.delta;if(a.anchor){if("b"==a.anchor.toLowerCase()||"beginning"==a.anchor)i=0;if("m"==a.anchor.toLowerCase()||"middle"==a.anchor)i=0.5;if("e"==a.anchor.toLowerCase()||"end"==a.anchor)i=1}d>h?(d-h<g&&(g=d-h),d-=g,f+=i*g):d<h&&(h-d<g&&(g=h-d),d+=g,f-=i*g);
b.delta=d;b.phi=f;c.restore();c.save();e.draw();d!=h?requestAnimFrame(function(){b.resize(a)}):a.callback&&a.callback()};socialCheesecake.Sector.prototype.focus=function(){var a=this.getRegion().layer.getContext(),b=this.getCheesecake().stage;this.rOut*=1.05;a.restore();a.save();b.draw()};socialCheesecake.Sector.prototype.unfocus=function(){var a=this.getRegion().layer.getContext(),b=this.getCheesecake().stage;this.rOut=this.originalAttr.rOut;a.restore();a.save();b.draw()};socialCheesecake.Sector.prototype.rotateTo=
function(a){var b=this,c=this.phi,e=this.delta,d=0.05,f=0,g=b.getCheesecake().stage,h=b.getRegion().layer.getContext();if(!a)throw"No arguments passed to the function";if(a.step)d=a.step;if(null==a.destination)throw"destination must be defined";if(a.anchor){if("b"==a.anchor.toLowerCase()||"beginning"==a.anchor)f=0;if("m"==a.anchor.toLowerCase()||"middle"==a.anchor)f=0.5;if("e"==a.anchor.toLowerCase()||"end"==a.anchor)f=1}for(e=(a.destination-f*e)%(2*Math.PI);0>e;)e+=2*Math.PI;f=0;e>c?f=1:e<c&&(f=
-1);Math.round(1E3*(2*Math.PI-Math.abs(e-c)))/1E3>=Math.round(1E3*Math.abs(e-c))/1E3?(Math.abs(e-c)<d&&(d=Math.abs(e-c)),c+=f*d):(2*Math.PI-Math.abs(e-c)<d&&(d=2*Math.PI-Math.abs(e-c)),e-=2*f*Math.PI,c-=f*d);b.phi=c;h.restore();h.save();g.draw();0.001<Math.abs(c-e)?(b.phi=c%(2*Math.PI),requestAnimFrame(function(){b.rotateTo({context:h,destination:a.destination,step:d,callback:a.callback,anchor:a.anchor})})):a.callback&&a.callback()};socialCheesecake.Sector.prototype.addActor=function(a,b){var c=this.actors,
e,d=!1,f;for(f in c)if(c[f].id==a.id){d=!0;e=c[f];var g=!1,h;for(h in e.parents)e.parents[h]==b&&(g=!0);g||e.parents.push(b)}d||(e=this==b?this.parent.addActor(a,b):this.parent.grid.addActor(a,b),c.push(e));return e};socialCheesecake.Subsector=function(a){if(null!=a.parent)this.parent=a.parent;this.label="";if(null!=a.label)this.label=a.label;this.x=a.x;this.y=a.y;this.rOut=a.rOut;this.rIn=a.rIn;this.phi=a.phi;this.delta=a.delta;this.actors=[];this.getCheesecake();if(a.actors)for(var b in a.actors)this.addActor({id:a.actors[b][0]},
this)};socialCheesecake.Subsector.prototype=new socialCheesecake.Sector({parent:this.parent,center:{x:this.x,y:this.y},label:this.label,rIn:this.rIn,rOut:this.rOut,phi:this.phi,delta:this.delta});socialCheesecake.Subsector.prototype.getCheesecake=function(){return this.parent.parent}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.Grid=function(a){if(!a)throw"No arguments passed to the function";console.log(a.actors);this.actors=[];this.parent=a.parent;this.id=a.grid_id;this.divIdPrefix=a.divIdPrefix};socialCheesecake.Grid.prototype.addActor=function(a,b){var c=this.actors,e,d=!1,f;for(f in c)if(c[f].id==a.id){d=!0;e=c[f];var g=!1,h;for(h in e.parents)e.parents[h]==b&&(g=!0);g||e.parents.push(b)}d||(e=new socialCheesecake.Actor({id:a.id,parent:b}),c.push(e));return e};socialCheesecake.Grid.prototype.getActor=
function(a){for(var b in actors)if(this.actors[b].id==a)return this.actors[b];return null};socialCheesecake.Grid.prototype.focus=function(a){if(a instanceof Array)for(var b in a){var c=a[b];c instanceof socialCheesecake.Actor?c.focus():this.getActor(c).focus()}else a instanceof socialCheesecake.Actor?a.focus():this.getActor(a).focus()};socialCheesecake.Grid.prototype.focusAll=function(){this.focus(this.actors)};socialCheesecake.Grid.prototype.hide=function(a){if(a instanceof Array)for(var b in a){var c=
a[b];c instanceof socialCheesecake.Actor?c.hide():this.getActor(c).hide()}else a instanceof socialCheesecake.Actor?a.hide():this.getActor(a).hide()};socialCheesecake.Grid.prototype.hideAll=function(){this.hide(this.actors)};socialCheesecake.Grid.prototype.show=function(a){if(a instanceof Array)for(var b in a){var c=a[b];c instanceof socialCheesecake.Actor?c.show():this.getActor(c).show()}else a instanceof socialCheesecake.Actor?a.show():this.getActor(a).show()};socialCheesecake.Grid.prototype.showAll=
function(){this.show(this.actors)};socialCheesecake.Grid.prototype.unfocus=function(a){if(a instanceof Array)for(var b in a){var c=a[b];c instanceof socialCheesecake.Actor?c.unfocus():this.getActor(c).unfocus()}else a instanceof socialCheesecake.Actor?a.unfocus():this.getActor(a).unfocus()};socialCheesecake.Grid.prototype.unfocusAll=function(){this.unfocus(this.actors)}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.Actor=function(a){if(!a)throw"No arguments passed to the function";if(!a.parent)throw"Actor must be associated to at least a subsector";var b={},c;for(c in b)c in a||(a[c]=b[c]);this.id=a.id;this.parents=[];a.parent&&this.parents.push(a.parent);var e=this,a=this.getCheesecake().grid.divIdPrefix,d=document.getElementById(a+this.id),f=function(){var a;e.focus();for(var b in e.parents)a=e.parents[b].parent,a.eventHandler("mouseover"),e.parents[b].eventHandler("mouseover")},
g=function(){var a;e.unfocus();for(var b in e.parents)a=e.parents[b].parent,a.eventHandler("mouseout"),e.parents[b].eventHandler("mouseout");console.log("mouseout")};d.addEventListener("mouseover",f,!1);d.addEventListener("mouseout",g,!1);d.addEventListener("mousedown",function(){arguments.callee.activeActor?(arguments.callee.activeActor=!1,d.addEventListener("mouseover",f,!1),d.addEventListener("mouseout",g,!1)):(arguments.callee.activeActor=!0,d.removeEventListener("mouseover",f,!1),d.removeEventListener("mouseout",
g,!1))})};socialCheesecake.Actor.prototype.focus=function(){var a=this.getCheesecake().grid.divIdPrefix,a=document.getElementById(a+this.id),b="";a.getAttribute("class")?a.getAttribute("class").match(/\sfocused/)||(b=a.getAttribute("class").concat(" focused"),a.setAttribute("class",b)):a.setAttribute("class","focused")};socialCheesecake.Actor.prototype.unfocus=function(){var a=this.getCheesecake().grid.divIdPrefix,a=document.getElementById(a+this.id),b="";a.getAttribute("class")&&(b=a.getAttribute("class").replace(/(^|\s)focused($|\s)/,
""),a.setAttribute("class",b))};socialCheesecake.Actor.prototype.isFocused=function(){var a=this.getCheesecake().grid.divIdPrefix,a=document.getElementById(a+this.id),b=!1;a.getAttribute("class")&&a.getAttribute("class").match(/(^|\s)focused($|\s)/)&&(b=!0);return b};socialCheesecake.Actor.prototype.hide=function(){var a=this.getCheesecake().grid.divIdPrefix,a=document.getElementById(a+this.id),b=" display: none;";a.getAttribute("style")&&(b=a.getAttribute("style").match(/display\s*:\s*[a-z]*;/)?
a.getAttribute("style").replace(/display\s*:\s*[a-z]*;/,"display: none;"):a.getAttribute("style").concat("display: none;"));a.setAttribute("style",b)};socialCheesecake.Actor.prototype.show=function(){var a=this.getCheesecake().grid.divIdPrefix,a=document.getElementById(a+this.id);if(a.getAttribute("style")){var b=a.getAttribute("style").replace(/display\s*:\s*none;/,"");a.setAttribute("style",b)}};socialCheesecake.Actor.prototype.fadeOut=function(){var a=this.getCheesecake().grid.divIdPrefix,a=document.getElementById(a+
this.id);a.getAttribute("style")&&(newStyle=a.getAttribute("style").match(/opacity\s*:\s*[a-zA-Z0-9]*;/)?a.getAttribute("style").replace(/opacity\s*:\s*[a-zA-Z0-9]*;/,"opacity: 0.5;"):a.getAttribute("style").concat("opacity: 1;"));a.setAttribute("style",newStyle)};socialCheesecake.Actor.prototype.getCheesecake=function(){return this.parents[0].parent.parent}})();socialCheesecake=socialCheesecake||{};
(function(){socialCheesecake.Cheesecake=function(a){var b=a.sectors,c=this;c.center={x:a.center.x,y:a.center.y};c.rMax=a.rMax;c.sectors=[];c.auxiliarSectors=[];c.stage=new Kinetic.Stage(a.container.id,a.container.width,a.container.height);c.grid=new socialCheesecake.Grid({parent:this,grid_id:a.grid.id,divIdPrefix:a.grid.divIdPrefix||"actor_"});for(var e=0,d=2*Math.PI/b.length,f=0;f<b.length;f++)c.sectors[f]=new socialCheesecake.Sector({parent:c,center:{x:a.center.x,y:a.center.y},label:b[f].name,phi:e,
delta:d,rOut:a.rMax,subsectors:b[f].subsectors,mouseover:{color:"#aaffaa",callback:function(a){document.body.style.cursor="pointer";c.grid.hideAll();for(var b in a.actors)a.actors[b].show();a.focus()}},mouseout:{color:"#eeffee",callback:function(a){document.body.style.cursor="default";c.grid.showAll();a.unfocus()}},mousedown:{color:"#77ff77",callback:function(a){c.focusAndBlurCheesecake(a);c.grid.hideAll();for(var b in a.actors)a.actors[b].show()}},mouseup:{color:"#aaffaa"}}),c.stage.add(c.sectors[f].getRegion()),
e+=d};socialCheesecake.Cheesecake.prototype.focusAndBlurCheesecake=function(a){var b=this,c=b.stage.getShapes(),e,d;for(d in b.sectors)b.sectors[d]===a&&(e=d);if(null==e)throw"sector doesn't belong to this cheesecake";for(d=c.length-1;0<=d;d--)c[d].permanent||b.stage.remove(c[d]);b.grid.unfocusAll();var c={parent:b,center:{x:b.center.x,y:b.center.y},phi:a.phi,delta:a.delta,rOut:a.rOut,label:a.label,simulate:e,mouseout:{callback:function(){document.body.style.cursor="default"}},mouseover:{callback:function(){document.body.style.cursor=
"pointer"}}},f=new socialCheesecake.Sector({parent:b,center:{x:b.center.x,y:b.center.y},phi:a.phi+a.delta,delta:2*Math.PI-a.delta,rOut:b.rMax,mouseout:{color:"#f5f5f5",callback:function(){document.body.style.cursor="default"}},mousedown:{color:"#f5f5f5"},mouseup:{color:"#f5f5f5"},mouseover:{color:"#f5f5f5",callback:function(){document.body.style.cursor="pointer"}},color:"#f5f5f5"});b.auxiliarSectors.push(f);var g=new socialCheesecake.Sector(c);b.auxiliarSectors.push(g);b.stage.add(f.getRegion());
b.stage.add(g.getRegion());var h=function(){b.unfocusAndUnblurCheesecake();b.grid.showAll()},i=function(){f.mousedown.callback=h},j=function(){g.splitUp()};f.rotateTo({destination:5*Math.PI/4,callback:function(){f.resize({delta:3*Math.PI/2,anchor:"M",callback:i})},anchor:"M"});g.rotateTo({destination:Math.PI/4,callback:function(){g.resize({anchor:"M",callback:j})},anchor:"M"})};socialCheesecake.Cheesecake.prototype.recoverCheesecake=function(){for(var a=this.stage.getShapes(),b=a.length-1;0<=b;b--)a[b].permanent||
this.stage.remove(a[b]);this.auxiliarSectors.pop();for(b in this.sectors)this.stage.add(this.sectors[b].getRegion())};socialCheesecake.Cheesecake.prototype.unfocusAndUnblurCheesecake=function(){var a=this,b=this.auxiliarSectors,c,e,d;for(d in b)null!=b[d].simulate?c=b[d]:e=b[d];c.putTogether();c.resize({anchor:"M",delta:c.originalAttr.delta,callback:function(){c.rotateTo({destination:c.originalAttr.phi})}});e.resize({anchor:"M",delta:e.originalAttr.delta,callback:function(){e.rotateTo({destination:e.originalAttr.phi,
callback:function(){a.recoverCheesecake()}})}})}})();
