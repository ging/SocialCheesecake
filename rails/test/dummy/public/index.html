<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<link href="assets/application.css" rel="stylesheet" type="text/css"></style>
		<script src="assets/application.js"></script>
		<script>
		  var counterSectors = 0;
		  var counterSubsectors = [0];
		  var newSectorModel;
		  var labels = {
		    sector: "Sector",
		    subsector: "Subsector",
		    label: "label_",
		    actors: "actors_"
		  }
		  var cheese;
      var cheesecakeData = {
        container: {
                id: "container",
                width: 440,
                height: 440
              },
              grid: {
                id: "grid",
                divIdPrefix: "actor_"
              },
          sectors: [
            {name:"John Connor Lider de la revolucion" ,  subsectors : [
              {id : 0, 
                name : "Cassidy", 
                actors: [
                  [0], 
                  [1],
                  [2]
                ]
              },
              {id : 1, name : "Cassidy2"}
            ]}, 
            { name:"3,14159265358979323846264338327950288419716939937510" , subsectors : [
              {id : 2, name : "Abc"}, 
              {id : 3, 
                name : "Cassidy2",  
                actors: [ 
                  [3, "cosa", 5],
                  [4]
                ]
              }
            ]}, 
            { name:"Luke I am your father", subsectors : [
              {id : 4, name : "Luke I am your father"}
            ]},
            { name:"Olivia",subsectors : [
              {id : 5, name : "Dunham"},
              {id : 6, name : "FBI"}
            ]},
            { name:"Altivia",subsectors : [
              {id : 7, name : "Dunham"},
              {id : 8, name : "FBI"}
            ]},
            { name:"Walter",subsectors : [
              {id : 9, name : "Bishop"},
              {id : 10, name : "Craziness",
              actors: [[3]]
            }]
            },
            { name:"Nina",subsectors : [
              {id : 11, name : "Massive Dynamic"}
            ]},
            { name:"Alibab√°",subsectors : [
              {id : 12, name : "Cueva"}
            ]},
            { name:"Mudito",subsectors : [
              {id : 13, name : "Bosque Encantado"}
            ]},
            { name:"Eewok",subsectors : [
              {id : 14, name : "Bosque de Endor"}
            ]} 
          ],
         onChange : function(){
           console.log("Cambio detectado"); 
         }
      };
      window.onload = function(){
        newSectorModel = $("#s0").clone();
      }
			window.requestAnimFrame = (function(callback) {
				return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
				function(callback) {
					window.setTimeout(callback, 1000 / 60);
				};
			})();
			function addSector(){
			  var prevSector = "#s"+counterSectors;
			  counterSectors++;
			  counterSubsectors.push(0);
			  var newSector = newSectorModel.clone();
        newSector.attr("id","s"+counterSectors);
        newSector.find('.subtitle').text("Sector "+counterSectors);
        newSector.find('.subsubtitle').text("Subsector 0");
        newSector.find("#label_s0").attr("id","label_s"+counterSectors);
        newSector.find("#s0s0").attr("id","s"+counterSectors+"s0");
        newSector.find("#label_s0s0").attr("id","label_s"+counterSectors+"s0");
        var actors = newSector.find(".actors");
        for( var i= 0; i < actors.length; i++){
          actors[i].setAttribute("name", "actors_s"+counterSectors+"s0");
        }
        newSector.find('button').attr('onclick',"addSubsector("+counterSectors+")");
        $(newSector).insertAfter(prevSector);
			}
			function addSubsector(sector){
			  console.log(sector);
        var prevSubsector = "#s"+sector+"s"+counterSubsectors[sector];
        counterSubsectors[sector]++;
        var newSubsector = $("#s0s0").clone();
        newSubsector.attr("id","s"+sector+"s"+counterSubsectors[sector]);
        newSubsector.find('.subsubtitle').text("Subsector "+counterSubsectors[sector]);
        newSubsector.find("#label_s0s0").attr("id","label_s"+sector+"s"+counterSubsectors[sector]);
        var actors = newSubsector.find(".actors");
        for( var i= 0; i < actors.length; i++){
          actors[i].setAttribute("name", "actors_s"+sector+"s"+counterSubsectors[sector]);
        }
        $(newSubsector).insertAfter(prevSubsector);
      }
			function checkboxesToActorsArray(name){
			  var checkboxes = document.settings[name];
			  var result =[];
			  for (var i = 0; i< checkboxes.length; i++){
		      if(checkboxes[i].checked){
		        var actor = [];
		        actor.push(i);
		        result.push(actor);
		      }
			  }
			  return result;
			}
			function createCheese(){
			  var rMax = parseInt(document.getElementById("rmax").value);
			  var x = parseInt(document.getElementById("x").value);
			  var y = parseInt(document.getElementById("y").value);
			  var subsectorsSector1 = [];
			  subsectorsSector1.push({
			    name : document.getElementById("label_s0s0").value,
			    actors: checkboxesToActorsArray("actors_s0s0")
			  });
			  var sector1 = { 
			    name : document.getElementById("label_s0").value,
			    subsectors : subsectorsSector1
		    };
			  
			  cheesecakeData.rMax = rMax;
			  cheesecakeData.center = {x : x, y: y};
			  cheesecakeData.sectors.push(sector1);
			  
			  cheese = new socialCheesecake.Cheesecake(cheesecakeData);
			}
		</script>
	</head>
	<body id="container" >
		<div id="grid">
			<div class="actor" id="actor_0"><img src="assets/youngAlberto.png">
			</div>
			<div class="actor" id="actor_1"><img src="assets/beatriz.png">
			</div>
			<div class="actor" id="actor_2"><img src="assets/rails.png">
			</div>
			<div class="actor" id="actor_3"><img src="assets/beatriz.png">
			</div>
			<div class="actor" id="actor_4"><img src="assets/youngAlberto.png">
			</div>
		</div>
		<div class="buttons">
			<button type="button" onclick="cheese.grid.actors[0].focus()">Focus 0</button>
			<button type="button" onclick="cheese.grid.actors[0].unfocus()">unfocus 0</button>
			<button type="button" onclick="cheese.grid.actors[0].hide()">hide 0</button>
			<button type="button" onclick="cheese.grid.actors[0].show()">show 0</button>
			<button type="button" onclick="cheese.grid.actors[0].fadeOut(1000)">fadeOut 0</button>
			<button type="button" onclick="cheese.grid.actors[0].fadeIn(1000)">fadeIn 0</button>
			<button type="button" onclick="cheese.grid.actors[0].unselect()">unselect 0</button>
			<button type="button" onclick="cheese.grid.focusAll()">Focus all!</button>
			<button type="button" onclick="cheese.grid.unfocusAll()">Unfocus all!</button>
			<button type="button" onclick="cheese.grid.hideAll()">Hide all!</button>
			<button type="button" onclick="cheese.grid.showAll()">Show all!</button>
			<button type="button" onclick="cheese.grid.unselectAll()">Unselect all!</button>
		</div>
		<form name ="settings" id= "form">
		  <div class = "title label">General Settings</div>
		  <div class = "row">
        <div class = "label">Centre</div>
        <input type ="text" id ="x" value = "220"/>
        <input type ="text" id ="y" value = "220"/>
      </div>
		  <div class = "row">
		    <div class = "label">Radio</div>
		    <input type ="text" id ="rmax" value = "200"/>
		  </div>
		  <div class = "title label">Sectors</div>
		  <div class="sector" id="s0">
  		  <div class = "subtitle label">Sector 0</div>
  		  <div class = "row">
          <div class = "label">Name</div>
          <input type ="text" id ="label_s0" value = "John Connor Lider de la revolucion"/>
        </div>
        <div class= "subsector" id="s0s0">
          <div class = "subsubtitle label">Subsector 0</div>
          <div class = "row">
            <div class = "label">Name:</div>
            <input type ="text" id ="label_s0s0" value = "Cassidy"/>
            <div class = "label">Actors:</div>
            <input type ="checkbox" class="actors" name ="actors_s0s0" value = "0" />0
            <input type ="checkbox" class="actors" name ="actors_s0s0" value = "1" />1
            <input type ="checkbox" class="actors" name ="actors_s0s0" value = "2" />2
            <input type ="checkbox" class="actors" name ="actors_s0s0" value = "3"/>3
            <input type ="checkbox" class="actors" name ="actors_s0s0" value = "4"/>4
          </div>
        </div>
        <div class = "buttons">
          <button type="button" onclick="addSubsector(0)">Add Subsector</button>
        </div>
      </div>
      <div class = "buttons" id= "add_sector">
        <button type="button" onclick="addSector()">Add Sector</button>
      </div>
		  <div class = "buttons" id= "done">
		    <button type="button" onclick="createCheese()">Done!</button>
		  </div>
		</div>
	</body>
</html>
